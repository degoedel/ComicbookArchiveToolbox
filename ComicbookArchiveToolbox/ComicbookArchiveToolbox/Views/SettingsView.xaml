<UserControl x:Class="ComicbookArchiveToolbox.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:converters="clr-namespace:ComicbookArchiveToolbox.CommonTools"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             prism:ViewModelLocator.AutoWireViewModel="True">
	<UserControl.Resources>
		<converters:InverseBooleanConverter x:Key="InverseConverter"/>

		<!-- Custom Tooltip Style for Multi-line Display -->
		<Style x:Key="MultiLineTooltipStyle" TargetType="ToolTip">
			<Setter Property="MaxWidth" Value="300"/>
			<Setter Property="ContentTemplate">
				<Setter.Value>
					<DataTemplate>
						<TextBlock Text="{Binding}" 
								   TextWrapping="Wrap"
								   MaxWidth="300"/>
					</DataTemplate>
				</Setter.Value>
			</Setter>
		</Style>
	</UserControl.Resources>

	<ScrollViewer>
		<StackPanel Margin="24">
			<!-- Modern Header -->
			<StackPanel Orientation="Horizontal" Margin="0,0,0,32">
				<iconPacks:PackIconModern Kind="Settings" 
                                          Width="32" 
                                          Height="32" 
                                          Foreground="{DynamicResource MahApps.Brushes.Text}"
                                          VerticalAlignment="Center"
                                          Margin="0,0,16,0"/>
				<TextBlock Text="Settings" 
                           Style="{DynamicResource MahApps.Styles.TextBlock.Title}"
                           FontSize="28"
                           VerticalAlignment="Center"/>
			</StackPanel>

			<!-- General Settings Card -->
			<Border Style="{StaticResource ModernCard}">
				<StackPanel>
					<TextBlock Text="General" 
                               Style="{DynamicResource MahApps.Styles.TextBlock.SubHeader}"
                               Margin="0,0,0,16"/>

					<mah:ToggleSwitch Header="Always include cover in generated files"
                                      IsOn="{Binding AlwaysIncludeCover}"
                                      Margin="0,8">
						<mah:ToggleSwitch.ToolTip>
							<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
									 Content="{Binding AlwaysIncludeCoverTooltip}"/>
						</mah:ToggleSwitch.ToolTip>
					</mah:ToggleSwitch>

					<mah:ToggleSwitch Header="Always include metadata if available"
                                      IsOn="{Binding AlwaysIncludeMetadata}"
                                      Margin="0,8">
						<mah:ToggleSwitch.ToolTip>
							<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
									 Content="{Binding AlwaysIncludeMetadataTooltip}"/>
						</mah:ToggleSwitch.ToolTip>
					</mah:ToggleSwitch>

					<mah:ToggleSwitch Header="Add File Index to Covers"
                                      IsOn="{Binding AddFileIndexToCovers}"
                                      Margin="0,8">
						<mah:ToggleSwitch.ToolTip>
							<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
									 Content="{Binding AddFileIndexToCoversTooltip}"/>
						</mah:ToggleSwitch.ToolTip>
					</mah:ToggleSwitch>
				</StackPanel>
			</Border>

			<!-- Buffer Directory Card -->
			<Border Style="{StaticResource ModernCard}">
				<StackPanel>
					<TextBlock Text="Buffer Directory" 
                               Style="{DynamicResource MahApps.Styles.TextBlock.SubHeader}"
                               Margin="0,0,0,16"/>

					<mah:ToggleSwitch Header="Use input file folder as buffer"
                                      IsOn="{Binding UseFileDirAsBuffer}"
                                      Margin="0,0,0,16">
						<mah:ToggleSwitch.ToolTip>
							<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
									 Content="{Binding UseFileDirAsBufferTooltip}"/>
						</mah:ToggleSwitch.ToolTip>
					</mah:ToggleSwitch>

					<StackPanel IsEnabled="{Binding UseFileDirAsBuffer, Converter={StaticResource InverseConverter}}">
						<TextBlock Text="Buffer Path" Margin="0,0,0,8"/>
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="Auto"/>
							</Grid.ColumnDefinitions>
							<TextBox Grid.Column="0" 
                                     Text="{Binding BufferPath}"
                                     Style="{StaticResource MahApps.Styles.TextBox}"
                                     Margin="0,0,8,0">
								<TextBox.ToolTip>
									<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
											 Content="{Binding BufferPathTooltip}"/>
								</TextBox.ToolTip>
							</TextBox>
							<Button Grid.Column="1" 
                                    Content="Browse..."
                                    Style="{StaticResource MahApps.Styles.Button.Square.Accent}"
                                    Command="{Binding BrowseDirectoryCommand}">
								<Button.ToolTip>
									<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
											 Content="Browse for a custom buffer directory location"/>
								</Button.ToolTip>
							</Button>
						</Grid>
					</StackPanel>

					<mah:ToggleSwitch Header="Flatten archive structure"
                                      IsOn="{Binding FlattenStructure}"
                                      Margin="0,8">
						<mah:ToggleSwitch.ToolTip>
							<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
									 Content="{Binding FlattenStructureTooltip}"/>
						</mah:ToggleSwitch.ToolTip>
					</mah:ToggleSwitch>
				</StackPanel>
			</Border>

			<!-- Output Settings Card -->
			<Border Style="{StaticResource ModernCard}">
				<StackPanel>
					<TextBlock Text="Output Settings" 
                               Style="{DynamicResource MahApps.Styles.TextBlock.SubHeader}"
                               Margin="0,0,0,16"/>

					<UniformGrid Columns="2">
						<StackPanel Margin="0,0,16,0">
							<TextBlock Text="Preferred output format" 
                                       Style="{DynamicResource MahApps.Styles.TextBlock.Caption}"
                                       Margin="0,0,0,8"/>
							<ComboBox ItemsSource="{Binding Formats}"
                                      SelectedItem="{Binding SelectedFormat}"
                                      Style="{StaticResource MahApps.Styles.ComboBox}">
								<ComboBox.ToolTip>
									<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
											 Content="{Binding SelectedFormatTooltip}"/>
								</ComboBox.ToolTip>
							</ComboBox>
						</StackPanel>
						<StackPanel>
							<TextBlock Text="Default Image Height" 
                                       Style="{DynamicResource MahApps.Styles.TextBlock.Caption}"
                                       Margin="0,0,0,8"/>
							<mah:NumericUpDown Value="{Binding DefaultImageHeight}"
                                               Minimum="100"
                                               Maximum="4096"
                                               Interval="100">
								<mah:NumericUpDown.ToolTip>
									<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
											 Content="{Binding DefaultImageHeightTooltip}"/>
								</mah:NumericUpDown.ToolTip>
							</mah:NumericUpDown>
						</StackPanel>
					</UniformGrid>
				</StackPanel>
			</Border>

			<!-- Performance Settings Card -->
			<Border Style="{StaticResource ModernCard}">
				<StackPanel>
					<TextBlock Text="Performance Settings" 
                               Style="{DynamicResource MahApps.Styles.TextBlock.SubHeader}"
                               Margin="0,0,0,16"/>

					<StackPanel Margin="0,8">
						<TextBlock Text="Performance Mode" 
                                   Style="{DynamicResource MahApps.Styles.TextBlock.Caption}"
                                   Margin="0,0,0,8"/>
						<ComboBox ItemsSource="{Binding PerformanceModes}"
                                  SelectedItem="{Binding PerformanceMode}"
                                  Style="{StaticResource MahApps.Styles.ComboBox}">
							<ComboBox.ToolTip>
								<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
										 Content="{Binding PerformanceModeTooltip}"/>
							</ComboBox.ToolTip>
						</ComboBox>
					</StackPanel>

					<StackPanel Margin="0,8">
						<TextBlock Text="{Binding BatchSize, StringFormat='Batch Size: {0}'}" 
                                   Style="{DynamicResource MahApps.Styles.TextBlock.Caption}"
                                   Margin="0,0,0,8"/>
						<Slider Minimum="1" 
                                Maximum="50" 
                                Value="{Binding BatchSize}" 
                                TickFrequency="5" 
                                TickPlacement="BottomRight"
                                IsSnapToTickEnabled="True">
							<Slider.ToolTip>
								<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
										 Content="{Binding BatchSizeTooltip}"/>
							</Slider.ToolTip>
						</Slider>
					</StackPanel>

					<mah:ToggleSwitch Header="Enable CPU Throttling"
                                      IsOn="{Binding EnableThrottling}"
                                      Margin="0,8">
						<mah:ToggleSwitch.ToolTip>
							<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
									 Content="{Binding EnableThrottlingTooltip}"/>
						</mah:ToggleSwitch.ToolTip>
					</mah:ToggleSwitch>

					<StackPanel Orientation="Horizontal" Margin="0,16,0,0">
						<iconPacks:PackIconModern Kind="Monitor" 
                                                  Width="16" 
                                                  Height="16" 
                                                  Foreground="{DynamicResource MahApps.Brushes.Accent}"
                                                  VerticalAlignment="Center"
                                                  Margin="0,0,8,0"/>
						<TextBlock Text="{Binding CurrentCpuUsage, StringFormat='Current CPU Usage: {0:F1}%'}"
                                   Style="{DynamicResource MahApps.Styles.TextBlock.Caption}"
                                   VerticalAlignment="Center">
							<TextBlock.ToolTip>
								<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
										 Content="Real-time CPU usage monitoring.\nHigh values may indicate the need\nto switch to Low Resource mode."/>
							</TextBlock.ToolTip>
						</TextBlock>
					</StackPanel>
				</StackPanel>
			</Border>

			<!-- Action Buttons -->
			<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
				<Button Content="Save Settings" 
                        Style="{StaticResource MahApps.Styles.Button.Square.Accent}"
                        Command="{Binding SaveSettingsCommand}"
                        Width="140"
                        Height="40">
					<Button.ToolTip>
						<ToolTip Style="{StaticResource MultiLineTooltipStyle}"
								 Content="{Binding SaveSettingsTooltip}"/>
					</Button.ToolTip>
					<Button.ContentTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<iconPacks:PackIconModern Kind="Save" Width="16" Height="16" Margin="0,0,8,0"/>
								<TextBlock Text="{Binding}"/>
							</StackPanel>
						</DataTemplate>
					</Button.ContentTemplate>
				</Button>
			</StackPanel>
		</StackPanel>
	</ScrollViewer>
</UserControl>