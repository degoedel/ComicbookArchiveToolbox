<UserControl x:Class="ComicbookArchiveToolbox.Module.Edit.Views.EditPluginView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ComicbookArchiveToolbox.Module.Edit.Views"
             xmlns:prism="http://prismlibrary.com/"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             prism:ViewModelLocator.AutoWireViewModel="True"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">

	<ScrollViewer>
		<StackPanel Margin="24">
			<!-- Modern Header -->
			<StackPanel Orientation="Horizontal" Margin="0,0,0,32">
				<iconPacks:PackIconModern Kind="Edit" 
                                          Width="32" 
                                          Height="32" 
                                          Foreground="{DynamicResource MahApps.Brushes.Text}"
                                          VerticalAlignment="Center"
                                          Margin="0,0,16,0"/>
				<TextBlock Text="Edit Metadata" 
                           Style="{DynamicResource MahApps.Styles.TextBlock.Title}"
                           FontSize="28"
                           VerticalAlignment="Center"/>
			</StackPanel>

			<!-- File Selection Card -->
			<Border Style="{StaticResource ModernCard}">
				<StackPanel>
					<TextBlock Text="File Selection" 
                               Style="{DynamicResource MahApps.Styles.TextBlock.SubHeader}"
                               Margin="0,0,0,16"/>

					<mah:MetroHeader Header="File To Edit">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*"/>
								<ColumnDefinition Width="Auto"/>
							</Grid.ColumnDefinitions>
							<TextBox Grid.Column="0" 
                                     Text="{Binding FileToEdit, Mode=TwoWay}"
                                     Style="{StaticResource MahApps.Styles.TextBox}"
                                     Margin="0,0,8,0"/>
							<Button Grid.Column="1" 
                                    Content="Browse..."
                                    Style="{StaticResource MahApps.Styles.Button.Square}"
                                    Command="{Binding BrowseFileCommand}"/>
						</Grid>
					</mah:MetroHeader>
				</StackPanel>
			</Border>

			<!-- Calibre Import/Export Card -->
			<Border Style="{StaticResource ModernCard}">
				<StackPanel>
					<TextBlock Text="Calibre Metadata" 
                               Style="{DynamicResource MahApps.Styles.TextBlock.SubHeader}"
                               Margin="0,0,0,0"/>

					<TextBlock Text="Import or export metadata in Calibre HTML format with Dublin Core standards."
                               Style="{DynamicResource MahApps.Styles.TextBlock}"
                               Foreground="{DynamicResource MahApps.Brushes.Gray1}"
                               Margin="0,0,0,0"/>

					<StackPanel Orientation="Horizontal">
						<Button Content="Import from Calibre HTML" 
                                Style="{StaticResource MahApps.Styles.Button.Square}"
                                Command="{Binding ImportCalibreCommand}"
                                Width="200"
                                Height="35"
								Margin="0,0,0,0"
                                ToolTip="Import metadata from Calibre HTML file with Dublin Core format">
							<Button.ContentTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal">
										<iconPacks:PackIconMaterial Kind="ApplicationImport" Width="14" Height="14" Margin="0,0,8,0"/>
										<TextBlock Text="{Binding}"/>
									</StackPanel>
								</DataTemplate>
							</Button.ContentTemplate>
						</Button>

						<!--<Button Content="Export to Calibre HTML" 
                                Style="{StaticResource MahApps.Styles.Button.Square}"
                                Command="{Binding ExportCalibreCommand}"
                                Width="200"
                                Height="35"
								Margin="8,0,0,0"
                                ToolTip="Export current metadata to Calibre HTML format with Dublin Core">
							<Button.ContentTemplate>
								<DataTemplate>
									<StackPanel Orientation="Horizontal">
										<iconPacks:PackIconMaterial Kind="ApplicationExport" Width="14" Height="14" Margin="0,0,8,0"/>
										<TextBlock Text="{Binding}"/>
									</StackPanel>
								</DataTemplate>
							</Button.ContentTemplate>
						</Button>-->
					</StackPanel>
				</StackPanel>
			</Border>

			<!-- Metadata Editing Card -->
			<Border Style="{StaticResource ModernCard}">
				<StackPanel>
					<TextBlock Text="Metadata Fields" 
                               Style="{DynamicResource MahApps.Styles.TextBlock.SubHeader}"
                               Margin="0,0,0,16"/>

					<TextBlock Text="Edit the metadata fields below. You can add new rows or delete existing ones. Changes will be saved in ComicInfo.xml format."
                               Style="{DynamicResource MahApps.Styles.TextBlock}"
                               Foreground="{DynamicResource MahApps.Brushes.Gray1}"
                               Margin="0,0,0,16"/>

					<DataGrid ItemsSource="{Binding MetadataCollection}"  
                              CanUserDeleteRows="True" 
                              CanUserAddRows="True" 
                              MinHeight="200"
                              MaxHeight="350"
                              ScrollViewer.CanContentScroll="True" 
                              ScrollViewer.VerticalScrollBarVisibility="Auto"
                              ScrollViewer.HorizontalScrollBarVisibility="Auto"
                              Style="{DynamicResource MahApps.Styles.DataGrid}"
                              Background="{DynamicResource MahApps.ThemeBackground}"
                              Foreground="{DynamicResource MahApps.Brushes.Text}">
						<DataGrid.Columns>
							<DataGridTextColumn Header="Field Name" 
                                                Binding="{Binding Key, Mode=TwoWay}"
                                                Width="200"/>
							<DataGridTextColumn Header="Value" 
                                                Binding="{Binding Value, Mode=TwoWay}"
                                                Width="*"/>
						</DataGrid.Columns>
					</DataGrid>
				</StackPanel>
			</Border>

			<!-- Action Button -->
			<StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
				<Button Content="Save Changes" 
                        Style="{StaticResource MahApps.Styles.Button.Square.Accent}"
                        Command="{Binding SaveCommand}"
                        Width="160"
                        Height="40">
					<Button.ContentTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<iconPacks:PackIconModern Kind="Save" Width="16" Height="16" Margin="0,0,8,0"/>
								<TextBlock Text="{Binding}"/>
							</StackPanel>
						</DataTemplate>
					</Button.ContentTemplate>
				</Button>
			</StackPanel>
		</StackPanel>
	</ScrollViewer>
</UserControl>